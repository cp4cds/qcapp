<br>
<br>
{% extends 'qcapp/base.html' %}
{% load static %}

{% block extrahead %}{{ block.super }}
     <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

{% endblock %}

{% block title %}
<h1>Dataset QC: {{page_title}}</h1>
{% endblock %}

{% block contents %}


<table class="table table-hover">

<thead> <tr>
    {% for facet in facets %}

    <th>{{facet|capfirst}}</th>
    {% endfor %}
</thead>
<tbody>

<tr>
    {% for facet, values in facets.iteritems %}
    <td>
        <select class="facet-filter" id={{facet}}>
            <option value="All">All</option>
            {% for item in values %}
                <option value={{item}}>{{item}}</option>
            {% endfor %}
        </select>
    </td>
    {% endfor %}
</tr>

</tbody>

</table>

<form action="{% url 'variable-dataset-qc' page_title %}" method="post">
    {% csrf_token %}
    <input value="JUST DO IT" type="submit" class="btn btn-success" id="file_qc_list">
</form>
<h2>Files with QC errors</h2>


<table class="table table-hover">
<thead>
 <tr> <th>Dataset</th> <th>Max global errors</th> <th>Max variable errors</th> <th>Max other errors</th> </tr>
</thead>
<tbody>

    {% for error in unique_dataset %}
       <tr>
           <!--<th><a href="http://127.0.0.1:8000/variable-qc/{{error.file.ncfile}}">-->
               <!--{{error.file.dataset.institute}} {{error.file.dataset.model}} {{error.file.dataset.experiment}}-->
               <!--{{error.file.dataset.frequency}} {{error.file.dataset.realm}} {{error.file.dataset.cmor_table}}-->
               <!--{{error.file.dataset.ensemble}}-->
                <!--</a>-->
           <!--</th>-->
           <th>
               <a href="http://127.0.0.1:8000/variable-qc/{{error}}">
               {{ error }}
               </a>
           </th>
           <th></th><th></th><th></th>
        <!--{% for err in max_errors %}-->
           <!--<th></th> {{ err.global }} <th> {{ err.variable }} </th> {{ err.other }} <th></th>-->
        <!--{% endfor %}-->
       </tr>
    {% endfor %}

</tbody>

</table>




    <script>
        $('.facet-filter').change(function () {
            var model = $('#models').val()
            var experiment = $('#experiments').val()
            var target = "/facet-filter/" + model + '/' + experiment
            $.get(target, function (data) {
                console.log(JSON.stringify(data))
            })
        })


//        $('#file_qc_list').click(function () {
//            var target = "/file-qc-list/"
//            $.get(target, function (data) {
//                for (i=0; i is <data.length; i++){};
//
//            })
//        })


        //    $('#models').change(function () {
//        var val = $(this).val()
//    })
//    $('#frequencies').change(function () {
//        var val = $(this).val()
//    })
//    $('#realms').change(function () {
//        var val = $(this).val()
//    })
//    $('#tables').change(function () {
//        var val = $(this).val()
//    })
//    $('#ensembles').change(function () {
//        var val = $(this).val()
//    })

    </script>

{% endblock %}
